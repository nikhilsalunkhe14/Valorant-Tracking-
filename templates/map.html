{% extends "base.html" %}

{% block title %}{{ map.name if map else 'Map' }} - Map Detail{% endblock %}

{% block content %}
<div class="container">
    <div class="glass" style="padding:24px;">
        {% if map %}
        <h2 style="font-family:'Rajdhani',sans-serif;font-size:28px;color:var(--valo-gold);">{{ map.name }}</h2>
        <p style="color:var(--dark-text-muted);">{{ map.description }}</p>
        <div style="margin-top:18px;display:flex;gap:20px;flex-direction:column;align-items:center;">
            {% if layout_file %}
                <!-- Clickable layout image that opens a lightbox for full view -->
                <img id="map-thumb" src="{{ layout_file }}" alt="{{ map.name }} layout" style="max-width:100%;height:auto;border-radius:6px;box-shadow:var(--glass-shadow);cursor:zoom-in;">
                <div style="color:var(--dark-text-muted);font-size:13px;margin-top:8px;">Tactical layout (site structure) — click image to open full view</div>
                <div style="color:var(--dark-text-muted);font-size:12px;margin-top:6px;">Detected layout file: <code>{{ layout_file }}</code></div>
            {% elif map.layout %}
                <img id="map-thumb" src="{{ map.layout }}" alt="{{ map.name }} layout" style="max-width:100%;height:auto;border-radius:6px;box-shadow:var(--glass-shadow);cursor:zoom-in;">
                <div style="color:var(--dark-text-muted);font-size:13px;margin-top:8px;">Tactical layout (configured path) — click image to open full view</div>
            {% else %}
                <img id="map-thumb" src="{{ map.image }}" alt="{{ map.name }} full map" style="max-width:100%;height:auto;border-radius:12px;box-shadow:var(--glass-shadow);cursor:zoom-in;">
                <div style="color:var(--dark-text-muted);font-size:13px;margin-top:8px;">Full map photo (no tactical layout available) — click image to open full view</div>
            {% endif %}
            <div style="margin-top:6px;color:var(--dark-text-muted);font-size:13px;max-width:900px;text-align:center;">If you have a tactical site-structure image, place it under <code>/static/images/maps/layouts/</code> with name <code>&lt;mapname&gt;_layout.png</code> (e.g. <code>bind_layout.png</code>).</div>
        </div>

        <!-- Lightbox modal -->
        <div id="map-lightbox" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:9999;align-items:center;justify-content:center;padding:24px;">
            <button id="map-lightbox-close" style="position:absolute;top:18px;right:18px;background:transparent;border:none;color:#fff;font-size:28px;cursor:pointer;">&times;</button>
            <div style="max-width:100%;max-height:100%;overflow:auto;border-radius:8px;display:flex;align-items:center;justify-content:center;">
                <img id="map-lightbox-img" src="" alt="Full map layout" style="max-width:1600px;max-height:90vh;display:block;"> 
            </div>
        </div>

        <script>
            (function(){
                const thumb = document.getElementById('map-thumb');
                const lightbox = document.getElementById('map-lightbox');
                const lbImg = document.getElementById('map-lightbox-img');
                const closeBtn = document.getElementById('map-lightbox-close');

                if (!thumb || !lightbox) return;

                thumb.addEventListener('click', () => {
                    lbImg.src = thumb.src;
                    lightbox.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                });

                closeBtn.addEventListener('click', () => {
                    lightbox.style.display = 'none';
                    document.body.style.overflow = '';
                });

                lightbox.addEventListener('click', (e) => {
                    if (e.target === lightbox) {
                        lightbox.style.display = 'none';
                        document.body.style.overflow = '';
                    }
                });
            })();
        </script>
        {% else %}
        <div style="padding:40px;text-align:center;">
            <h2 style="color:var(--valo-red);">Map not found</h2>
            <p style="color:var(--dark-text-muted);">The requested map could not be located.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

